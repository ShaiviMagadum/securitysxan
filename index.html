<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Behavior Detection AI â€“ Crime Scene Model</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Bebas+Neue&display=swap" rel="stylesheet">

<!-- TensorFlow + Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
    body {
        margin: 0;
        background: #111;
        font-family: 'Inter', sans-serif;
        color: white;
        text-align: center;
    }

    header {
        padding: 20px;
        background: #222;
        border-bottom: 4px solid #f5d000;
    }

    h1 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 55px;
        letter-spacing: 2px;
        color: #f5d000;
        margin-bottom: 5px;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 20px;
    }

    #webcam-container {
        margin: auto;
        margin-top: 20px;
    }

    #label-container div {
        font-size: 18px;
        margin-top: 4px;
    }

    button {
        margin-top: 15px;
        padding: 12px 25px;
        font-size: 18px;
        background: #f5d000;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
    }

    button:hover {
        background: #ffe155;
    }

    /* GAME AREA */
    #game-area {
        width: 100%;
        height: 320px;
        background: rgba(255, 255, 255, 0.04);
        border: 2px dashed #f5d000;
        margin-top: 25px;
        position: relative;
        overflow: hidden;
    }

    .tile {
        width: 40px;
        height: 40px;
        position: absolute;
        top: -50px;
        border-radius: 4px;
        animation: fall 3s linear forwards;
    }

    @keyframes fall {
        to { top: 350px; opacity: 0; }
    }

    footer {
        margin-top: 50px;
        padding: 30px;
        font-size: 14px;
        color: #aaa;
    }

    .section-title {
        font-family: 'Bebas Neue';
        color: #f5d000;
        font-size: 32px;
        margin-top: 40px;
        margin-bottom: 10px;
    }
</style>
</head>
<body>

<header>
    <h1>Behavior Detection AI</h1>
    <p>A Teachable Machine Model for Identifying Risk-Related Human Behaviors</p>
</header>

<div class="container">

    <!-- Required Sections -->
    <div class="section-title">Project Overview</div>
    <p>
        This project uses a Teachable Machine image model to detect situations such as 
        <strong>Normal</strong>, <strong>Drinking</strong>, <strong>Mugshot</strong>, 
        <strong>Violence</strong>, and <strong>Victim</strong>.  
        It can help raise awareness of unsafe or risky environments.
    </p>

    <div class="section-title">How It Works</div>
    <p>
        The model uses image data from your webcam, processes each frame through TensorFlow.js,
        and assigns probabilities to each of the five categories.  
        These predictions update in real-time directly in your browser.
    </p>

    <div class="section-title">Try It Yourself</div>
    <p>Click below to load the model, activate your webcam, and view predictions live.</p>

    <button onclick="init()">Start Model</button>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <div class="section-title">Live Reaction Mini-Game</div>
    <p>
        As the AI detects behaviors, tiles will spawn according to what the camera sees:
        <br>ðŸ”´ Violence â†’ Danger Tile  
        <br>ðŸ”µ Victim â†’ Help Tile  
        <br>ðŸŸ¡ Drinking â†’ Caution Tile  
        <br>âš« Mugshot â†’ Neutral Tile  
    </p>

    <div id="game-area"></div>
</div>

<footer>
    Built using Google Teachable Machine + TensorFlow.js
</footer>


<!-- JAVASCRIPT -->
<script>
const URL = "./my_model/";

let model, webcam, labelContainer, maxPredictions;

// Load the model & webcam
async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    webcam = new tmImage.Webcam(250, 250, true);
    await webcam.setup();
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam-container").appendChild(webcam.canvas);

    labelContainer = document.getElementById("label-container");
    for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
    }
}

// Game tile spawner
function spawnTile(type) {
    const area = document.getElementById("game-area");
    const tile = document.createElement("div");
    tile.classList.add("tile");

    const colors = {
        "Violence": "red",
        "Victim": "dodgerblue",
        "Drinking": "gold",
        "Mugshot": "gray"
    };

    tile.style.background = colors[type];
    tile.style.left = Math.random() * (area.offsetWidth - 40) + "px";

    area.appendChild(tile);
    setTimeout(() => tile.remove(), 3500);
}

let lastSpawnTime = 0;

// Prediction loop
async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

async function predict() {
    const prediction = await model.predict(webcam.canvas);

    let currentClass = null;
    let highestProb = 0;

    // Display predictions
    for (let i = 0; i < maxPredictions; i++) {
        const className = prediction[i].className;
        const prob = prediction[i].probability;

        labelContainer.childNodes[i].innerHTML =
            className + ": " + prob.toFixed(2);

        if (prob > highestProb) {
            highestProb = prob;
            currentClass = className;
        }
    }

    // Spawn tile if high confidence (over 0.85) and not too often
    if (highestProb > 0.85 && currentClass !== "Normal") {
        const now = Date.now();
        if (now - lastSpawnTime > 1000) {
            spawnTile(currentClass);
            lastSpawnTime = now;
        }
    }
}
</script>

</body>
</html>
